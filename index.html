<HTML><HEAD>
<SCRIPT TYPE="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
</HEAD>
<BODY>

<DIV id="needToLogin">
Please visit the <A HREF="options.html">options</A> page to enter your login.
</DIV>


<IFRAME CLASS="content" ID="content" NAME="content" ALIGN=RIGHT WIDTH="80%" HEIGHT="100%" SRC="starting.html"></iframe>


<div class="unreadList"> </div>
<div class="spacer" style="width:20%;float:left;">

</div>


<SCRIPT type="text/javascript">

api_key = "3a9p4Q74Afnu9x6f53gePqNm6ddeac82";

$(document).ready(function() {
    username = localStorage["username"];
    password = localStorage["password"];
    count = localStorage["count"];
    
    if (!username || !password) {
        return;
    }
    $("#needToLogin").hide();

    if (!count) {
        count = 25;
    }
    
    var url = "https://readitlaterlist.com/v2/get?state=unread&" +
        "&apikey=" + api_key + "&count=" + count + 
        "&username=" + username + "&password=" + password;

    $.getJSON(url, renderLinks);
});

function markAsRead(url) {
    url = escape(url);
    url = url.replace(/\+/g, "%2B");
    
    read_url = "https://readitlaterlist.com/v2/send?" +
        "&username=" + username +
        "&password=" + password + 
        "&apikey=" + api_key +
        '&read={"0":{"url":"' + url + '"}}';

    console.log(read_url);
    $.get(read_url);
}


function renderLinks(data) {
    links = data.list;
    $("div.unreadList").append("<UL>");
    c = 0;
    for (var key in links) {
        link = "<LI> <A HREF='" + links[key].url +
            "' class=contentLink target=content>" + 
            links[key].title + "</A> " +
            '[<A HREF="#" class="markread" id=n' + c++ + 
            ' onclick=markAsRead("' +
            links[key].url + '")>R</A>]' + "<BR />";

        link = "<LI> <A HREF='" + links[key].url +
            "' class=contentLink target=content>" + 
            links[key].title + "</A> " +
            '<A HREF="#" class="markread" id=n' + c++ + 
            ' onclick=markAsRead("' + links[key].url + '")>' +
            '<IMG HEIGHT=15 WIDTH=15 SRC="white.png"></A>' + "<BR />";

        console.log(link);

        
        $("div.unreadList").append(link);
    }
    $("div.unreadList").append("</UL>");

    // Mark as read hook
    $('.markread').click(function() {
        $(this).closest("li").remove();
    });

}



</SCRIPT>
</BODY>
</HTML>
